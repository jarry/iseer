<?xml version="1.0" encoding="utf-8"?>
<!--
process:
        1. copy empty directory to ${compile-path} from ${js-path}
        2. compress **/*.js ${compile-path} under, output ${compile-path}.The *.js changed name to *-min.js
        3. move **/*-min.js ${compile-path} under to ${js-path}, overlay the **/*.js.
        4. delete the ${compile-path} directory;
        
        CSS files method like this

mail: JarryLi@gmail.com 
-->
<project name="Jiae JS Files Compress" default="Compress JS Files" basedir=".">
        <property name="root-path" value="../.." />
    <property name="js-src-path" value="${root-path}/js-src" />
    <property name="js-path" value="${root-path}/webapp/js" />
    <property name="tools-path" value="${root-path}/tools" />    
    <property name="yuicompressor" value="${tools-path}/js/yuicompressor-2.4.2.jar" />
        <property name="webpacker" value="${tools-path}/js/webpacker.jar" />
 
    <property name="compile-path" value="tmp" />
        
        <!--    // compress js  -->
        <target name="Compress JS Files" depends="">
                
                
                <echo message="Copy JS files Begin" />
                <mkdir dir="${compile-path}" /> 
                <copy todir="${compile-path}">
                        <fileset dir="${js-path}">
                                <exclude name="**/*.*"/>
                                <!-- copy folders only -->
                        </fileset>
                </copy>
                <echo message="Copy JS Files Finished" />
                
                        
                <echo message="Compress Code Begin" />
                <apply executable="java" parallel="false" failonerror="true" dest="${compile-path}">
                        <fileset dir="${js-path}" includes="**/*.js" />
                        <arg line="-jar"/>
                        
                        <!-- yuicompressor -->
                        <arg path="${yuicompressor}" />
                        <arg line="--charset utf-8" /> 
                        <arg line="--type js"/>
               
                        <!-- webpacker -->
                        <!--
                        <arg path="${webpacker}" />
                        <arg line="- -charset utf-8" /> 
                        <arg line="- -mode 1" />
                        -->
                         
                        <arg line="-o" />
                        <targetfile/>
                        <mapper type="glob" from="*.js" to="*-min.js" />
                </apply>
                <echo message="Compress Code Finished" />
                        
                        <!-- move all js files to ${js-path} from ${compile-path} -->
                        <echo message="Copy compress files Begin" />
                        <move todir="${js-path}">
                        <fileset dir="${compile-path}">
                                <include name="**/*.js"/>
                        </fileset>
                        <mapper type="glob" from="*-min.js" to="*.js"/>
                        </move> 
                        
                        <!-- delete the ${compile-path} directory trees -->
                        <!--<delete dir="${compile-path}"/>-->
                        
                <echo message="Copy compress JS files Finished" /> 
        </target>       
        
</project>
